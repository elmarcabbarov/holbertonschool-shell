#!/usr/bin/env bash
# Init script to manage the 'manage_my_process' daemon

# Define the location for the Process ID (PID) file
PIDFILE="/var/run/my_process.pid"

# Define the path to the process we are managing
PROCESS_SCRIPT="./manage_my_process"

##
# do_start: Function to perform the start action
##
do_start() {
    # Start the process in the background
    "$PROCESS_SCRIPT" &
    
    # Write PID to file. Ignore errors (for 'set -e' and permissions)
    echo $! > "$PIDFILE" 2>/dev/null || true
}

##
# do_stop: Function to perform the stop action
##
do_stop() {
    # Check if the PID file exists
    if [ -f "$PIDFILE" ]; then
        # Kill process. Ignore errors (if process missing, etc.)
        kill "$(cat "$PIDFILE")" 2>/dev/null || true
        
        # Remove PID file. Ignore errors (permissions, etc.)
        rm -f "$PIDFILE" 2>/dev/null || true
    fi
}

##
# Main script logic using a 'case' statement
##
case "$1" in
    start)
        do_start
        echo "manage_my_process started"
        ;;
    stop)
        do_stop
        echo "manage_my_process stopped"
        ;;
    restart)
        # Stop the process
        do_stop
        
        # Start the process
        do_start
        
        # Display ONLY the restart message
        echo "manage_my_process restarted"
        ;;
    *)
        # Default case if $1 is empty or not recognized
        echo "Usage: manage_my_process {start|stop|restart}"
        exit 1
        ;;
esac

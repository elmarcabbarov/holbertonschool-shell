#!/usr/bin/env bash
# Init script to manage the 'manage_my_process' daemon

# Define the location for the Process ID (PID) file
PIDFILE="/var/run/my_process.pid"

# Define the path to the process we are managing
# This assumes 'manage_my_process' is in the same directory
PROCESS_SCRIPT="./manage_my_process"

##
# Start Function
##
start() {
    # Start the process in the background (&)
    "$PROCESS_SCRIPT" &
    
    # Capture the PID of the last backgrounded process ($!) and write it to the PID file
    echo $! > "$PIDFILE"
    echo "manage_my_process started"
}

##
# Stop Function
##
stop() {
    # Check if the PID file exists
    if [ -f "$PIDFILE" ]; then
        # Read the PID from the file and send the KILL signal
        kill "$(cat "$PIDFILE")"
        
        # Remove the PID file
        rm -f "$PIDFILE"
    fi
    # Display the stop message (as required by the prompt, even if it wasn't running)
    echo "manage_my_process stopped"
}

##
# Restart Function
##
restart() {
    # Call the stop function
    stop
    
    # Call the start function
    start
    
    # Display the restart message
    echo "manage_my_process restarted"
}

##
# Main script logic using a 'case' statement
##
case "$1" in
    start)
        start
        ;;
    stop)
        stop
        ;;
    restart)
        restart
        ;;
    *)
        # Default case if $1 is empty or not recognized
        echo "Usage: manage_my_process {start|stop|restart}"
        exit 1
        ;;
esac
